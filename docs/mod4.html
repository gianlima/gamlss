<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Módulo 4</title>

<script src="site_libs/header-attrs-2.3/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">GAMLSS</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Módulos
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Caderno.html">Módulo 1 - Resumo</a>
    </li>
    <li>
      <a href="exemplo_inicial.html">Módulo 1 - Conteúdo</a>
    </li>
    <li>
      <a href="mod2.html">Módulo 2</a>
    </li>
    <li>
      <a href="mod3_1.html">Módulo 3 - 1/2</a>
    </li>
    <li>
      <a href="mod3_2.html">Módulo 3 - 2/2</a>
    </li>
    <li>
      <a href="mod4.html">Módulo 4</a>
    </li>
    <li>
      <a href="mod5.html">Módulo 5</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Módulo 4</h1>

</div>


<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">require</span>(gamlss)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">require</span>(MASS)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">require</span>(gamlss.add)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">require</span>(ISLR)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">require</span>(car)</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">data</span>(<span class="st">&quot;mcycle&quot;</span>)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="kw">head</span>(<span class="st">&quot;mcycle&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;mcycle&quot;</code></pre>
<div id="polinômios" class="section level3">
<h3><span style="color:#05C086">Polinômios</span></h3>
<div id="ordem-1" class="section level4">
<h4>Ordem 1</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>ajuste1p &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span>times, <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1395.722 
## GAMLSS-RS iteration 2: Global Deviance = 1395.722</code></pre>
</div>
<div id="ordem-2" class="section level4">
<h4>Ordem 2</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>ajuste2p &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(times,<span class="dv">2</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1387.315 
## GAMLSS-RS iteration 2: Global Deviance = 1387.315</code></pre>
</div>
<div id="ordem-3" class="section level4">
<h4>Ordem 3</h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>ajuste3p &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(times,<span class="dv">5</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1308.537 
## GAMLSS-RS iteration 2: Global Deviance = 1308.537</code></pre>
</div>
<div id="ordem-10" class="section level4">
<h4>Ordem 10</h4>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>ajuste4p &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(times,<span class="dv">10</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1206.351 
## GAMLSS-RS iteration 2: Global Deviance = 1206.351</code></pre>
</div>
<div id="gráfico" class="section level4">
<h4>Gráfico</h4>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">par</span>(<span class="dt">cex =</span> <span class="fl">1.2</span>, <span class="dt">las =</span> <span class="dv">1</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">plot</span>(accel <span class="op">~</span><span class="st"> </span>times, <span class="dt">data =</span> mcycle, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Aceleração&#39;</span>, </span>
<span id="cb11-3"><a href="#cb11-3"></a>     <span class="dt">xlab =</span> <span class="st">&#39;Tempo após o impacto (ms)&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Polinômios&#39;</span>)</span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co"># ordem 2</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste1p)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co"># ordem 2</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste2p)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co"># ordem 3</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste3p)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co"># ordem 10</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste4p)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;green&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="kw">legend</span>(<span class="dt">x =</span> <span class="st">&quot;bottomright&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&#39;black&#39;</span>, <span class="st">&#39;red&#39;</span>, <span class="st">&#39;blue&#39;</span>, <span class="st">&#39;green&#39;</span>),</span>
<span id="cb11-13"><a href="#cb11-13"></a>       <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&#39;Ordem 1&#39;</span>, <span class="st">&#39;Ordem 2&#39;</span>, <span class="st">&#39;Ordem 5&#39;</span>, <span class="st">&#39;Ordem 10&#39;</span>))</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">GAIC</span>(ajuste1p, ajuste2p, ajuste3p, ajuste4p, <span class="dt">k =</span> <span class="dv">2</span>) <span class="co"># Comparação via AIC.</span></span></code></pre></div>
<pre><code>##          df      AIC
## ajuste4p 12 1230.351
## ajuste3p  7 1322.537
## ajuste2p  4 1395.315
## ajuste1p  3 1401.722</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">GAIC</span>(ajuste1p, ajuste2p, ajuste3p, ajuste4p, <span class="dt">k =</span> <span class="kw">log</span>(<span class="dv">133</span>)) <span class="co"># Comparação via BIC.</span></span></code></pre></div>
<pre><code>##          df      AIC
## ajuste4p 12 1265.035
## ajuste3p  7 1342.770
## ajuste2p  4 1406.877
## ajuste1p  3 1410.393</code></pre>
<p>Em ambos os casos o polinômio de maior ordem produz menores valores. No entanto, fica evidente que o polinômio de grau 10 é demasiadamente complexo para ajustar os dados, apresentando várias oscilações que não refletem a relação entre as variáveis.</p>
<hr />
</div>
</div>
<div id="polinômios-fracionários" class="section level3">
<h3><span style="color:#05C086">Polinômios fracionários</span></h3>
<div id="ordem-1-1" class="section level4">
<h4>Ordem 1</h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>ajuste1fp &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">fp</span>(times, <span class="dt">npoly =</span> <span class="dv">1</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1391.019 
## GAMLSS-RS iteration 2: Global Deviance = 1391.019</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">getSmo</span>(ajuste1fp)<span class="op">$</span>power</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>O único termo inserido no modelo é x^2.</p>
</div>
<div id="ordem-2-1" class="section level4">
<h4>Ordem 2</h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>ajuste2fp &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">fp</span>(times, <span class="dt">npoly =</span> <span class="dv">2</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1376.56 
## GAMLSS-RS iteration 2: Global Deviance = 1376.56</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">getSmo</span>(ajuste2fp)<span class="op">$</span>power</span></code></pre></div>
<pre><code>## [1] 0.5 0.5</code></pre>
<p>Os termos inseridos no modelo são <span class="math inline">\(x^{0.5} \text{ e } x^{0.5}*log(x).\)</span>$</p>
</div>
<div id="ordem-3-1" class="section level4">
<h4>Ordem 3</h4>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>ajuste3fp &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">fp</span>(times, <span class="dt">npoly =</span> <span class="dv">3</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1351.969 
## GAMLSS-RS iteration 2: Global Deviance = 1351.969</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">getSmo</span>(ajuste3fp)<span class="op">$</span>power</span></code></pre></div>
<pre><code>## [1] 2 2 2</code></pre>
<p>Os termos inseridos no modelo são <span class="math inline">\(x^2\)</span> e <span class="math inline">\(x^2*log(x)\)</span> e <span class="math inline">\(x^2*(log(x))^2.\)</span></p>
</div>
<div id="gráfico-1" class="section level4">
<h4>Gráfico</h4>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw">plot</span>(accel <span class="op">~</span><span class="st"> </span>times, <span class="dt">data =</span> mcycle, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Aceleração&#39;</span>, </span>
<span id="cb28-2"><a href="#cb28-2"></a>     <span class="dt">xlab =</span> <span class="st">&#39;Tempo após o impacto (ms)&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Polinômios fracionários&#39;</span>)</span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="co"># ordem 1</span></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste1fp)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="co"># ordem 2</span></span>
<span id="cb28-6"><a href="#cb28-6"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste2fp)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb28-7"><a href="#cb28-7"></a><span class="co"># ordem 3</span></span>
<span id="cb28-8"><a href="#cb28-8"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste3fp)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb28-9"><a href="#cb28-9"></a><span class="kw">legend</span>(<span class="dt">x =</span> <span class="st">&quot;bottomright&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&#39;black&#39;</span>, <span class="st">&#39;red&#39;</span>, <span class="st">&#39;blue&#39;</span>),</span>
<span id="cb28-10"><a href="#cb28-10"></a>       <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&#39;Ordem 1&#39;</span>, <span class="st">&#39;Ordem 2&#39;</span>, <span class="st">&#39;Ordem 3&#39;</span>))</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">GAIC</span>(ajuste1fp, ajuste2fp, ajuste3fp, <span class="dt">k =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##           df      AIC
## ajuste3fp  8 1367.969
## ajuste2fp  6 1388.560
## ajuste1fp  4 1399.019</code></pre>
<p>Novamente o modelo com maior número de parâmetros produziu menor AIC, mas o ajuste é claramente insatisfatório.</p>
<hr />
</div>
</div>
<div id="regressão-por-splines" class="section level3">
<h3><span style="color:#05C086">Regressão por splines</span></h3>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>ajuste1rs &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(times, <span class="dt">df =</span> <span class="dv">3</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1354.634 
## GAMLSS-RS iteration 2: Global Deviance = 1354.634</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="kw">attr</span>(<span class="kw">bs</span>(mcycle<span class="op">$</span>times, <span class="dt">df =</span> <span class="dv">3</span>),<span class="st">&quot;knots&quot;</span>) <span class="co"># Zero nós.</span></span></code></pre></div>
<pre><code>## numeric(0)</code></pre>
<p>Os três graus de liberdade, neste caso, estão associados aos termos linear, quadrático e cúbico globais. Não há graus de liberdade para parâmetros adicionais, referentes a ajustes locais (entre nós).</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw">library</span>(magrittr)</span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="kw">model.matrix</span>(ajuste1rs) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(., <span class="dt">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    (Intercept) bs(times, df = 3)1 bs(times, df = 3)2 bs(times, df = 3)3
## 1            1         0.00000000       0.000000e+00       0.000000e+00
## 2            1         0.01079094       3.923979e-05       4.756338e-08
## 3            1         0.04222715       6.209876e-04       3.044057e-06
## 4            1         0.06241267       1.386948e-03       1.027369e-05
## 5            1         0.08198862       2.447422e-03       2.435245e-05
## 6            1         0.17906630       1.323836e-02       3.262373e-04
## 7            1         0.19484697       1.604622e-02       4.404845e-04
## 8            1         0.20252756       1.754176e-02       5.064549e-04
## 9            1         0.23886717       2.590126e-02       9.361901e-04
## 10           1         0.25245613       2.964060e-02       1.160023e-03</code></pre>
<div id="matriz-do-modelo-x" class="section level4">
<h4>Matriz do modelo (X)</h4>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>ajuste2rs &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(times, <span class="dt">df =</span> <span class="dv">4</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1351.591 
## GAMLSS-RS iteration 2: Global Deviance = 1351.591</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="kw">attr</span>(<span class="kw">bs</span>(mcycle<span class="op">$</span>times, <span class="dt">df =</span> <span class="dv">4</span>),<span class="st">&quot;knots&quot;</span>) </span></code></pre></div>
<pre><code>##  50% 
## 23.4</code></pre>
<p>Com quatro graus de liberdade temos um parâmetro adicional no modelo que permite a divisão do intervalo de x em dois. Observe que, por default, a mediana de x é usada como coordenada do único nó.</p>
<p>Na sequência, para cada grau de liberdade adicional temos um nó e um subintervalo a mais no modelo.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>ajuste3rs &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(times, <span class="dt">df =</span> <span class="dv">5</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1298.061 
## GAMLSS-RS iteration 2: Global Deviance = 1298.061</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="kw">attr</span>(<span class="kw">bs</span>(mcycle<span class="op">$</span>times, <span class="dt">df =</span> <span class="dv">5</span>),<span class="st">&quot;knots&quot;</span>) <span class="co"># Dois nós.</span></span></code></pre></div>
<pre><code>## 33.33333% 66.66667% 
##      16.8      28.6</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>X &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(ajuste3rs);</span>
<span id="cb45-2"><a href="#cb45-2"></a>ajuste3_rs_alt &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span>X <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1298.061 
## GAMLSS-RS iteration 2: Global Deviance = 1298.061</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>ajuste4rs &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(times, <span class="dt">df =</span> <span class="dv">6</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1286.605 
## GAMLSS-RS iteration 2: Global Deviance = 1286.605</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="kw">attr</span>(<span class="kw">bs</span>(mcycle<span class="op">$</span>times, <span class="dt">df =</span> <span class="dv">6</span>),<span class="st">&quot;knots&quot;</span>) <span class="co"># Três nós.</span></span></code></pre></div>
<pre><code>##  25%  50%  75% 
## 15.6 23.4 34.8</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>ajuste5rs &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(times, <span class="dt">df =</span> <span class="dv">7</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1215.093 
## GAMLSS-RS iteration 2: Global Deviance = 1215.093</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="kw">attr</span>(<span class="kw">bs</span>(mcycle<span class="op">$</span>times, <span class="dt">df =</span> <span class="dv">7</span>),<span class="st">&quot;knots&quot;</span>) <span class="co"># Quatro nós.</span></span></code></pre></div>
<pre><code>##   20%   40%   60%   80% 
## 14.68 18.44 26.52 36.20</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>ajuste6rs &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(times, <span class="dt">df =</span> <span class="dv">8</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1201.596 
## GAMLSS-RS iteration 2: Global Deviance = 1201.596</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="kw">attr</span>(<span class="kw">bs</span>(mcycle<span class="op">$</span>times, <span class="dt">df =</span> <span class="dv">8</span>),<span class="st">&quot;knots&quot;</span>) <span class="co"># Cinco nós.</span></span></code></pre></div>
<pre><code>## 16.66667% 33.33333%       50% 66.66667% 83.33333% 
##      14.6      16.8      23.4      28.6      39.4</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>ajuste7rs &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(times, <span class="dt">df =</span> <span class="dv">9</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1207.46 
## GAMLSS-RS iteration 2: Global Deviance = 1207.46</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="kw">attr</span>(<span class="kw">bs</span>(mcycle<span class="op">$</span>times, <span class="dt">df =</span> <span class="dv">9</span>),<span class="st">&quot;knots&quot;</span>) <span class="co"># Seis nós.</span></span></code></pre></div>
<pre><code>## 14.28571% 28.57143% 42.85714% 57.14286% 71.42857% 85.71429% 
##  13.54286  16.14286  19.40000  25.77143  32.22857  41.60000</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>ajuste8rs &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(times, <span class="dt">df =</span> <span class="dv">10</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1196.268 
## GAMLSS-RS iteration 2: Global Deviance = 1196.268</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="kw">attr</span>(<span class="kw">bs</span>(mcycle<span class="op">$</span>times, <span class="dt">df =</span> <span class="dv">10</span>),<span class="st">&quot;knots&quot;</span>) <span class="co"># Sete nós.</span></span></code></pre></div>
<pre><code>## 12.5%   25% 37.5%   50% 62.5%   75% 87.5% 
##  11.2  15.6  17.6  23.4  27.2  34.8  42.6</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a>ajuste9rs &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(times, <span class="dt">df =</span> <span class="dv">12</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1192.125 
## GAMLSS-RS iteration 2: Global Deviance = 1192.125</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="kw">attr</span>(<span class="kw">bs</span>(mcycle<span class="op">$</span>times, <span class="dt">df =</span> <span class="dv">12</span>),<span class="st">&quot;knots&quot;</span>) <span class="co"># Nove nós.</span></span></code></pre></div>
<pre><code>##   10%   20%   30%   40%   50%   60%   70%   80%   90% 
## 10.04 14.68 16.20 18.44 23.40 26.52 31.52 36.20 43.80</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a>ajuste10rs &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(times, <span class="dt">df =</span> <span class="dv">15</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1192.325 
## GAMLSS-RS iteration 2: Global Deviance = 1192.325</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="kw">attr</span>(<span class="kw">bs</span>(mcycle<span class="op">$</span>times, <span class="dt">df =</span> <span class="dv">15</span>),<span class="st">&quot;knots&quot;</span>) <span class="co"># Doze nós.</span></span></code></pre></div>
<pre><code>## 7.692308% 15.38462% 23.07692% 30.76923% 38.46154% 46.15385% 53.84615% 61.53846% 
##   8.80000  14.04615  15.40000  16.32308  17.75385  21.13846  25.00000  27.20000 
## 69.23077% 76.92308% 84.61538% 92.30769% 
##  31.07692  35.30769  40.27692  46.35385</code></pre>
<p>Vamos comparar os modelos usando GAIC com diferentes constantes de penalização.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="kw">GAIC</span>(ajuste1rs, ajuste2rs, ajuste3rs, ajuste4rs,</span>
<span id="cb75-2"><a href="#cb75-2"></a>     ajuste5rs, ajuste6rs, ajuste7rs, ajuste8rs,</span>
<span id="cb75-3"><a href="#cb75-3"></a>     ajuste9rs, ajuste10rs, <span class="dt">k =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##            df      AIC
## ajuste9rs  14 1220.125
## ajuste8rs  12 1220.268
## ajuste6rs  10 1221.596
## ajuste10rs 17 1226.325
## ajuste7rs  11 1229.460
## ajuste5rs   9 1233.093
## ajuste4rs   8 1302.606
## ajuste3rs   7 1312.061
## ajuste2rs   6 1363.591
## ajuste1rs   5 1364.634</code></pre>
<p>O ajuste com doze nós internos é selecionado.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="kw">GAIC</span>(ajuste1rs, ajuste2rs, ajuste3rs, ajuste4rs,</span>
<span id="cb77-2"><a href="#cb77-2"></a>     ajuste5rs, ajuste6rs, ajuste7rs, ajuste8rs,</span>
<span id="cb77-3"><a href="#cb77-3"></a>     ajuste9rs, ajuste10rs, <span class="dt">k =</span> <span class="fl">3.84</span>)</span></code></pre></div>
<pre><code>##            df      AIC
## ajuste6rs  10 1239.996
## ajuste8rs  12 1242.348
## ajuste9rs  14 1245.885
## ajuste5rs   9 1249.653
## ajuste7rs  11 1249.700
## ajuste10rs 17 1257.605
## ajuste4rs   8 1317.326
## ajuste3rs   7 1324.941
## ajuste1rs   5 1373.834
## ajuste2rs   6 1374.631</code></pre>
<p>O ajuste com quatro nós internos é selecionado.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="kw">GAIC</span>(ajuste1rs, ajuste2rs, ajuste3rs, ajuste4rs,</span>
<span id="cb79-2"><a href="#cb79-2"></a>     ajuste5rs, ajuste6rs, ajuste7rs, ajuste8rs,</span>
<span id="cb79-3"><a href="#cb79-3"></a>     ajuste9rs, ajuste10rs, <span class="dt">k =</span> <span class="kw">log</span>(<span class="kw">nrow</span>(mcycle)))</span></code></pre></div>
<pre><code>##            df      AIC
## ajuste6rs  10 1250.500
## ajuste8rs  12 1254.953
## ajuste5rs   9 1259.107
## ajuste9rs  14 1260.590
## ajuste7rs  11 1261.254
## ajuste10rs 17 1275.461
## ajuste4rs   8 1325.728
## ajuste3rs   7 1332.294
## ajuste1rs   5 1379.085
## ajuste2rs   6 1380.933</code></pre>
<p>O ajuste com quatro nós internos é selecionado.</p>
</div>
<div id="gráfico-2" class="section level4">
<h4>Gráfico</h4>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a><span class="kw">plot</span>(accel <span class="op">~</span><span class="st"> </span>times, <span class="dt">data =</span> mcycle, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Aceleração&#39;</span>, </span>
<span id="cb81-2"><a href="#cb81-2"></a>     <span class="dt">xlab =</span> <span class="st">&#39;Tempo após o impacto (ms)&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Regressão por splines&#39;</span>)</span>
<span id="cb81-3"><a href="#cb81-3"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste1rs)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb81-4"><a href="#cb81-4"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste4rs)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb81-5"><a href="#cb81-5"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste6rs)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb81-6"><a href="#cb81-6"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste10rs)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;green&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb81-7"><a href="#cb81-7"></a></span>
<span id="cb81-8"><a href="#cb81-8"></a><span class="kw">legend</span>(<span class="dt">x =</span> <span class="st">&quot;bottomright&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&#39;black&#39;</span>, <span class="st">&#39;red&#39;</span>, <span class="st">&#39;blue&#39;</span>, <span class="st">&#39;green&#39;</span>),</span>
<span id="cb81-9"><a href="#cb81-9"></a>       <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&#39;df = 3; K = 0&#39;</span>, <span class="st">&#39;df = 5; K = 2&#39;</span>, <span class="st">&#39;df = 8; K = 5&#39;</span>, <span class="st">&#39;df = 15; K = 12&#39;</span>))</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Observe que o modelo selecionado via AIC é diferente do escolhido usando as demais constantes de penalização. A penalização a ser utilizada é uma questão em aberto, de forma que AIC, em algumas aplicações, pode ser muito permissivo, conduzindo a modelos com elevado número de parâmetros, enquanto BIC pode ser muito conservador, conduzindo à seleção de modelos com falta de ajuste. Valores intermediários para a constante de penalização (como k=3 ou k=4) podem ser considerados.</p>
<hr />
</div>
</div>
<div id="regressão-usando-natural-splines" class="section level3">
<h3>Regressão usando natural splines</h3>
<p>Como alternativa ao modelo de regressão por splines selecionado via AIC na passagem anterior, vamos ajustar o correspondente modelo usando splines naturais.</p>
</div>
<div id="regressão-por-splines-1" class="section level3">
<h3><span style="color:#05C086">Regressão por splines</span></h3>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="kw">plot</span>(accel <span class="op">~</span><span class="st"> </span>times, <span class="dt">data =</span> mcycle, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Aceleração&#39;</span>, </span>
<span id="cb82-2"><a href="#cb82-2"></a>     <span class="dt">xlab =</span> <span class="st">&#39;Tempo após o impacto (ms)&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Natural splines vs cubic splines&#39;</span>)</span>
<span id="cb82-3"><a href="#cb82-3"></a></span>
<span id="cb82-4"><a href="#cb82-4"></a>ajuste0rs &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(times, <span class="dt">df =</span> <span class="dv">10</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1196.268 
## GAMLSS-RS iteration 2: Global Deviance = 1196.268</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="kw">attr</span>(<span class="kw">bs</span>(mcycle<span class="op">$</span>times, <span class="dt">df =</span> <span class="dv">10</span>),<span class="st">&quot;knots&quot;</span>)</span></code></pre></div>
<pre><code>## 12.5%   25% 37.5%   50% 62.5%   75% 87.5% 
##  11.2  15.6  17.6  23.4  27.2  34.8  42.6</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a>ajuste0nrs &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(times, <span class="dt">df =</span> <span class="dv">8</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1196.53 
## GAMLSS-RS iteration 2: Global Deviance = 1196.53</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a><span class="kw">attr</span>(<span class="kw">ns</span>(mcycle<span class="op">$</span>times, <span class="dt">df =</span> <span class="dv">8</span>),<span class="st">&quot;knots&quot;</span>)</span></code></pre></div>
<pre><code>## 12.5%   25% 37.5%   50% 62.5%   75% 87.5% 
##  11.2  15.6  17.6  23.4  27.2  34.8  42.6</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste0rs)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb90-2"><a href="#cb90-2"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste0nrs)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb90-3"><a href="#cb90-3"></a></span>
<span id="cb90-4"><a href="#cb90-4"></a><span class="kw">legend</span>(<span class="dt">x =</span> <span class="st">&quot;bottomright&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&#39;black&#39;</span>, <span class="st">&#39;red&#39;</span>),</span>
<span id="cb90-5"><a href="#cb90-5"></a>       <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&#39;Cubic spline&#39;</span>, <span class="st">&#39;Natural cubic spline&#39;</span>))</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<hr />
</div>
<div id="modelo-de-nós-livres" class="section level3">
<h3><span style="color:#05C086">Modelo de nós livres</span></h3>
<p>Nesta aplicação de modelos com nós livres vamos considerar apenas splines lineares.</p>
<div id="ajuste-com-um-nó." class="section level4">
<h4>Ajuste com um nó.</h4>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a>ajuste1fk &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">fk</span>(times, <span class="dt">degree =</span> <span class="dv">1</span>, <span class="dt">start =</span> <span class="dv">20</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1350.552 
## GAMLSS-RS iteration 2: Global Deviance = 1350.552</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="kw">getSmo</span>(ajuste1fk) <span class="co"># Posição estimada para o único nó.</span></span></code></pre></div>
<pre><code>## 
## Call:  fitFreeKnots(y = y, x = xvar, weights = w, degree = degree,  
##     knots = lambda, fixed = control$fixed, base = control$base) 
## 
## Coefficients:
## (Intercept)            x       XatBP1  
##      64.789       -5.397        8.380  
## Estimated Knots: 
##  BP1  
## 19.2</code></pre>
</div>
<div id="ajuste-com-dois-nós." class="section level4">
<h4>Ajuste com dois nós.</h4>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a>ajuste2fk &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">fk</span>(times, <span class="dt">degree =</span> <span class="dv">1</span>, <span class="dt">start =</span> <span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">30</span>)), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1254.327 
## GAMLSS-RS iteration 2: Global Deviance = 1254.327</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="kw">getSmo</span>(ajuste2fk) <span class="co"># Posição estimada para os dois nós.</span></span></code></pre></div>
<pre><code>## 
## Call:  fitFreeKnots(y = y, x = xvar, weights = w, degree = degree,  
##     knots = lambda, fixed = control$fixed, base = control$base) 
## 
## Coefficients:
## (Intercept)            x       XatBP1       XatBP2  
##      82.219       -7.062       31.978      -26.329  
## Estimated Knots: 
##   BP1    BP2  
## 23.40  28.89</code></pre>
</div>
<div id="ajuste-com-três-nós." class="section level4">
<h4>Ajuste com três nós.</h4>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a>ajuste3fk &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">fk</span>(times, <span class="dt">degree =</span> <span class="dv">1</span>, <span class="dt">start =</span> <span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>)), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1206.337 
## GAMLSS-RS iteration 2: Global Deviance = 1206.337</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a><span class="kw">getSmo</span>(ajuste3fk) <span class="co"># Posição estimada para os três nós.</span></span></code></pre></div>
<pre><code>## 
## Call:  fitFreeKnots(y = y, x = xvar, weights = w, degree = degree,  
##     knots = lambda, fixed = control$fixed, base = control$base) 
## 
## Coefficients:
## (Intercept)            x       XatBP1       XatBP2       XatBP3  
##     24.1449      -0.1026     -19.3539      39.0848     -21.2579  
## Estimated Knots: 
##   BP1    BP2    BP3  
## 13.87  21.02  29.79</code></pre>
</div>
<div id="ajuste-com-cinco-nós." class="section level4">
<h4>Ajuste com cinco nós.</h4>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a>ajuste4fk &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">fk</span>(times, <span class="dt">degree =</span> <span class="dv">1</span>, <span class="dt">start =</span> <span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>)), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1198.916 
## GAMLSS-RS iteration 2: Global Deviance = 1198.916</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a><span class="kw">getSmo</span>(ajuste4fk) <span class="co"># Posição estimada para os cinco nós.</span></span></code></pre></div>
<pre><code>## 
## Call:  fitFreeKnots(y = y, x = xvar, weights = w, degree = degree,  
##     knots = lambda, fixed = control$fixed, base = control$base) 
## 
## Coefficients:
## (Intercept)            x       XatBP1       XatBP2       XatBP3       XatBP4  
##     24.1458      -0.1027     -19.3541      39.0227     -24.7164       4.0634  
##      XatBP5  
##      2.5337  
## Estimated Knots: 
##   BP1    BP2    BP3    BP4    BP5  
## 13.87  21.01  30.63  38.79  48.80</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a><span class="kw">plot</span>(accel <span class="op">~</span><span class="st"> </span>times, <span class="dt">data =</span> mcycle, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Aceleração&#39;</span>, </span>
<span id="cb107-2"><a href="#cb107-2"></a>     <span class="dt">xlab =</span> <span class="st">&#39;Tempo após o impacto (ms)&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Modelo de nós livres&#39;</span>)</span>
<span id="cb107-3"><a href="#cb107-3"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste1fk)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb107-4"><a href="#cb107-4"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste2fk)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb107-5"><a href="#cb107-5"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste3fk)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb107-6"><a href="#cb107-6"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste4fk)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;green&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb107-7"><a href="#cb107-7"></a><span class="kw">legend</span>(<span class="dt">x =</span> <span class="st">&quot;bottomright&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&#39;black&#39;</span>, <span class="st">&#39;red&#39;</span>, <span class="st">&#39;blue&#39;</span>, <span class="st">&#39;green&#39;</span>),</span>
<span id="cb107-8"><a href="#cb107-8"></a>       <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&#39;K = 1&#39;</span>, <span class="st">&#39;K = 2&#39;</span>, <span class="st">&#39;K = 3&#39;</span>, <span class="st">&#39;K = 5&#39;</span>))</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
</div>
<div id="suavizadores-não-paramétricos" class="section level3">
<h3><span style="color:#05C086">Suavizadores não paramétricos</span></h3>
</div>
<div id="splines-cúbicos" class="section level3">
<h3>Splines cúbicos</h3>
<p>Vamos testar para diferentes números de graus de liberdade.</p>
<div id="df-0." class="section level4">
<h4>df = 0.</h4>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a>ajuste1cs &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">cs</span>(times, <span class="dt">df =</span> <span class="dv">0</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1395.721 
## GAMLSS-RS iteration 2: Global Deviance = 1395.72</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a><span class="kw">getSmo</span>(ajuste1cs)<span class="op">$</span>lambda1</span></code></pre></div>
<pre><code>## [1] 3763.144</code></pre>
</div>
<div id="df-1." class="section level4">
<h4>df = 1.</h4>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a>ajuste2cs &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">cs</span>(times, <span class="dt">df =</span> <span class="dv">1</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1367.493 
## GAMLSS-RS iteration 2: Global Deviance = 1367.493</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a><span class="kw">getSmo</span>(ajuste2cs)<span class="op">$</span>lambda1</span></code></pre></div>
<pre><code>## [1] 0.1085361</code></pre>
</div>
<div id="df-5." class="section level4">
<h4>df = 5.</h4>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a>ajuste3cs &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">cs</span>(times, <span class="dt">df =</span> <span class="dv">5</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1245.332 
## GAMLSS-RS iteration 2: Global Deviance = 1245.332</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a><span class="kw">getSmo</span>(ajuste3cs)<span class="op">$</span>lambda1</span></code></pre></div>
<pre><code>## [1] 0.001423792</code></pre>
</div>
<div id="df-10." class="section level4">
<h4>df = 10.</h4>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a>ajuste4cs &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">cs</span>(times, <span class="dt">df =</span> <span class="dv">10</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1195.224 
## GAMLSS-RS iteration 2: Global Deviance = 1195.224</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a><span class="kw">getSmo</span>(ajuste4cs)<span class="op">$</span>lambda1</span></code></pre></div>
<pre><code>## [1] 0.0001214281</code></pre>
</div>
<div id="df-30." class="section level4">
<h4>df = 30.</h4>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1"></a>ajuste5cs &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">cs</span>(times, <span class="dt">df =</span> <span class="dv">20</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1183.604 
## GAMLSS-RS iteration 2: Global Deviance = 1183.604</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1"></a><span class="kw">getSmo</span>(ajuste5cs)<span class="op">$</span>lambda1</span></code></pre></div>
<pre><code>## [1] 8.430169e-06</code></pre>
</div>
<div id="gráfico-3" class="section level4">
<h4>Gráfico</h4>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1"></a><span class="kw">plot</span>(accel <span class="op">~</span><span class="st"> </span>times, <span class="dt">data =</span> mcycle, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Aceleração&#39;</span>, </span>
<span id="cb128-2"><a href="#cb128-2"></a>     <span class="dt">xlab =</span> <span class="st">&#39;Tempo após o impacto (ms)&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Smoothing splines&#39;</span>)</span>
<span id="cb128-3"><a href="#cb128-3"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste1cs)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb128-4"><a href="#cb128-4"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste2cs)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;brown&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb128-5"><a href="#cb128-5"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste3cs)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb128-6"><a href="#cb128-6"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste4cs)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb128-7"><a href="#cb128-7"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste5cs)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;orange&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb128-8"><a href="#cb128-8"></a><span class="kw">legend</span>(<span class="dt">x =</span> <span class="st">&quot;bottomright&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&#39;black&#39;</span>, <span class="st">&#39;brown&#39;</span>, <span class="st">&#39;blue&#39;</span>, <span class="st">&#39;red&#39;</span>, <span class="st">&#39;orange&#39;</span>),</span>
<span id="cb128-9"><a href="#cb128-9"></a>       <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&#39;df = 0&#39;</span>, <span class="st">&#39;df = 1&#39;</span>, <span class="st">&#39;df = 5&#39;</span>, <span class="st">&#39;df = 10&#39;</span>, <span class="st">&#39;df = 20&#39;</span>))</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
</div>
<div id="comparação-dos-ajustes-usando-critérios-de-informação." class="section level4">
<h4>Comparação dos ajustes usando critérios de informação.</h4>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1"></a><span class="kw">GAIC</span>(ajuste1cs, ajuste2cs, ajuste3cs, ajuste4cs, ajuste5cs, <span class="dt">k =</span> <span class="dv">2</span>) <span class="co"># AIC</span></span></code></pre></div>
<pre><code>##                  df      AIC
## ajuste4cs 13.001470 1221.227
## ajuste5cs 23.002782 1229.609
## ajuste3cs  7.998970 1261.330
## ajuste2cs  4.000429 1375.494
## ajuste1cs  3.000035 1401.720</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1"></a><span class="kw">GAIC</span>(ajuste1cs, ajuste2cs, ajuste3cs, ajuste4cs, ajuste5cs, <span class="dt">k =</span> <span class="fl">3.84</span>) <span class="co"># k=3.84</span></span></code></pre></div>
<pre><code>##                  df      AIC
## ajuste4cs 13.001470 1245.150
## ajuste5cs 23.002782 1271.935
## ajuste3cs  7.998970 1276.048
## ajuste2cs  4.000429 1382.855
## ajuste1cs  3.000035 1407.240</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1"></a><span class="kw">GAIC</span>(ajuste1cs, ajuste2cs, ajuste3cs, ajuste4cs, ajuste5cs, <span class="dt">k =</span> <span class="kw">log</span>(<span class="kw">nrow</span>(mcycle))) <span class="co"># BIC</span></span></code></pre></div>
<pre><code>##                  df      AIC
## ajuste4cs 13.001470 1258.806
## ajuste3cs  7.998970 1284.449
## ajuste5cs 23.002782 1296.095
## ajuste2cs  4.000429 1387.057
## ajuste1cs  3.000035 1410.392</code></pre>
<hr />
</div>
</div>
<div id="p-splines" class="section level3">
<h3><span style="color:#05C086">P-splines</span></h3>
<p>Usando pb() não precisaremos declarar o número de graus de liberdade, mas ele será determinado com base na otimização de diferentes critérios.</p>
<p>Vamos comparar diferentes métodos para estimação do parâmetro de penalização usando p-splines.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1"></a>ajuste1pb &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">pb</span>(times, <span class="dt">method =</span> <span class="st">&#39;ML&#39;</span>), </span>
<span id="cb135-2"><a href="#cb135-2"></a>                    <span class="dt">sigma.fo=</span><span class="op">~</span><span class="st"> </span><span class="kw">pb</span>(times, <span class="dt">method =</span> <span class="st">&#39;ML&#39;</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1093.584 
## GAMLSS-RS iteration 2: Global Deviance = 1064.97 
## GAMLSS-RS iteration 3: Global Deviance = 1060.902 
## GAMLSS-RS iteration 4: Global Deviance = 1060.293 
## GAMLSS-RS iteration 5: Global Deviance = 1060.189 
## GAMLSS-RS iteration 6: Global Deviance = 1060.171 
## GAMLSS-RS iteration 7: Global Deviance = 1060.167 
## GAMLSS-RS iteration 8: Global Deviance = 1060.166</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1"></a>ajuste1pb<span class="op">$</span>df.fit</span></code></pre></div>
<pre><code>## [1] 26.47113</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1"></a>ajuste2pb &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">pb</span>(times, <span class="dt">method =</span> <span class="st">&#39;GAIC&#39;</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1206.772 
## GAMLSS-RS iteration 2: Global Deviance = 1196.089 
## GAMLSS-RS iteration 3: Global Deviance = 1195.841 
## GAMLSS-RS iteration 4: Global Deviance = 1195.837 
## GAMLSS-RS iteration 5: Global Deviance = 1195.836</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1"></a>ajuste2pb<span class="op">$</span>df.fit</span></code></pre></div>
<pre><code>## [1] 12.4619</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1"></a>ajuste3pb &lt;-<span class="st"> </span><span class="kw">gamlss</span>(accel <span class="op">~</span><span class="st"> </span><span class="kw">pb</span>(times, <span class="dt">method =</span> <span class="st">&#39;GCV&#39;</span>), <span class="dt">data =</span> mcycle)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1199.829 
## GAMLSS-RS iteration 2: Global Deviance = 1199.829</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1"></a>ajuste3pb<span class="op">$</span>df.fit</span></code></pre></div>
<pre><code>## [1] 11.19967</code></pre>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1"></a><span class="kw">plot</span>(accel <span class="op">~</span><span class="st"> </span>times, <span class="dt">data =</span> mcycle, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Aceleração&#39;</span>, </span>
<span id="cb147-2"><a href="#cb147-2"></a>     <span class="dt">xlab =</span> <span class="st">&#39;Tempo após o impacto (ms)&#39;</span>)</span>
<span id="cb147-3"><a href="#cb147-3"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste1pb)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb147-4"><a href="#cb147-4"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste2pb)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb147-5"><a href="#cb147-5"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste3pb)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb147-6"><a href="#cb147-6"></a><span class="kw">legend</span>(<span class="dt">x =</span> <span class="st">&quot;bottomright&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&#39;black&#39;</span>, <span class="st">&#39;red&#39;</span>, <span class="st">&#39;blue&#39;</span>),</span>
<span id="cb147-7"><a href="#cb147-7"></a>       <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&#39;ML - df = 13.33&#39;</span>, <span class="st">&#39;GAIC - df = 12.46&#39;</span>, <span class="st">&#39;GCV - df = 11.20&#39;</span>))</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>Para finalizar, vamos plotar os modelos selecionados usando diferentes tipos de termos aditivos.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1"></a><span class="kw">plot</span>(accel <span class="op">~</span><span class="st"> </span>times, <span class="dt">data =</span> mcycle, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Aceleração&#39;</span>, </span>
<span id="cb148-2"><a href="#cb148-2"></a>     <span class="dt">xlab =</span> <span class="st">&#39;Tempo após o impacto (ms)&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Modelos selecionados&#39;</span>)</span>
<span id="cb148-3"><a href="#cb148-3"></a></span>
<span id="cb148-4"><a href="#cb148-4"></a><span class="co"># Polinômio</span></span>
<span id="cb148-5"><a href="#cb148-5"></a></span>
<span id="cb148-6"><a href="#cb148-6"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste4p)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;aquamarine3&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb148-7"><a href="#cb148-7"></a></span>
<span id="cb148-8"><a href="#cb148-8"></a><span class="co"># Polinômio fracionário</span></span>
<span id="cb148-9"><a href="#cb148-9"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste3fp)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;brown&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb148-10"><a href="#cb148-10"></a></span>
<span id="cb148-11"><a href="#cb148-11"></a><span class="co"># Natural splines</span></span>
<span id="cb148-12"><a href="#cb148-12"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste0nrs)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;deeppink2&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb148-13"><a href="#cb148-13"></a></span>
<span id="cb148-14"><a href="#cb148-14"></a><span class="co"># Modelo de nós livres</span></span>
<span id="cb148-15"><a href="#cb148-15"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste4fk)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb148-16"><a href="#cb148-16"></a></span>
<span id="cb148-17"><a href="#cb148-17"></a><span class="co"># Smoothing splines</span></span>
<span id="cb148-18"><a href="#cb148-18"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste4cs)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb148-19"><a href="#cb148-19"></a></span>
<span id="cb148-20"><a href="#cb148-20"></a><span class="co"># P-splines</span></span>
<span id="cb148-21"><a href="#cb148-21"></a><span class="kw">lines</span>(<span class="kw">sort</span>(mcycle<span class="op">$</span>times), <span class="kw">fitted</span>(ajuste2pb)[<span class="kw">order</span>(mcycle<span class="op">$</span>times)], <span class="dt">col =</span> <span class="st">&#39;green&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb148-22"><a href="#cb148-22"></a></span>
<span id="cb148-23"><a href="#cb148-23"></a><span class="kw">legend</span>(<span class="dt">x =</span> <span class="st">&quot;bottomright&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&#39;aquamarine3&#39;</span>, <span class="st">&#39;brown&#39;</span>, <span class="st">&#39;deeppink2&#39;</span>, <span class="st">&#39;blue&#39;</span>, <span class="st">&#39;black&#39;</span>, <span class="st">&#39;green&#39;</span>),</span>
<span id="cb148-24"><a href="#cb148-24"></a>       <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&#39;Polinômio&#39;</span>, <span class="st">&#39;Polinômio frac.&#39;</span>, <span class="st">&#39;Natural splines&#39;</span>, <span class="st">&#39;Nós livres&#39;</span>, <span class="st">&#39;Smoothing splines&#39;</span>, <span class="st">&#39;P-splines&#39;</span>))</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<div id="comparação-via-critério-de-informação." class="section level4">
<h4>Comparação via critério de informação.</h4>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1"></a><span class="kw">GAIC</span>(ajuste4p, ajuste3fp, ajuste0nrs, ajuste4fk, ajuste4cs, ajuste2pb, <span class="dt">k =</span> <span class="dv">2</span>) <span class="co"># AIC</span></span></code></pre></div>
<pre><code>##                  df      AIC
## ajuste0nrs 10.00000 1216.530
## ajuste2pb  12.46190 1220.760
## ajuste4cs  13.00147 1221.227
## ajuste4fk  13.00000 1224.916
## ajuste4p   12.00000 1230.351
## ajuste3fp   8.00000 1367.969</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1"></a><span class="kw">GAIC</span>(ajuste4p, ajuste3fp, ajuste0nrs, ajuste4fk, ajuste4cs, ajuste2pb, <span class="dt">k =</span> <span class="fl">3.84</span>) <span class="co"># k=3.84</span></span></code></pre></div>
<pre><code>##                  df      AIC
## ajuste0nrs 10.00000 1234.930
## ajuste2pb  12.46190 1243.690
## ajuste4cs  13.00147 1245.150
## ajuste4fk  13.00000 1248.836
## ajuste4p   12.00000 1252.431
## ajuste3fp   8.00000 1382.689</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1"></a><span class="kw">GAIC</span>(ajuste4p, ajuste3fp, ajuste0nrs, ajuste4fk, ajuste4cs, ajuste2pb, <span class="dt">k =</span> <span class="kw">log</span>(<span class="dv">133</span>)) <span class="co"># BIC</span></span></code></pre></div>
<pre><code>##                  df      AIC
## ajuste0nrs 10.00000 1245.434
## ajuste2pb  12.46190 1256.780
## ajuste4cs  13.00147 1258.806
## ajuste4fk  13.00000 1262.490
## ajuste4p   12.00000 1265.035
## ajuste3fp   8.00000 1391.092</code></pre>
<hr />
</div>
</div>
<div id="análise-preço-de-imóveis" class="section level3">
<h3><span style="color:#05C086">Análise Preço de Imóveis</span></h3>
<p>Análise dos preços de imóveis em bairros (distritos) de Boston.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1"></a><span class="kw">data</span>(Boston)</span>
<span id="cb155-2"><a href="#cb155-2"></a><span class="kw">require</span>(GGally)</span></code></pre></div>
<p>Para esta aplicação vamos considerar as seguintes variáveis:</p>
<ul>
<li>medv: Valor mediano dos imóveis ocupados, em U$1.000 (resposta)<br />
</li>
<li>crim: Taxa de crimes per-capita;<br />
</li>
<li>rm: Número médio de cômodos por imóvel;<br />
</li>
<li>lstat: Porcentagem da população na classe mais baixa.</li>
</ul>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1"></a>Boston2 &lt;-<span class="st"> </span>Boston[,<span class="kw">c</span>(<span class="st">&quot;medv&quot;</span>, <span class="st">&quot;crim&quot;</span>, <span class="st">&quot;rm&quot;</span>, <span class="st">&quot;lstat&quot;</span>)]</span>
<span id="cb156-2"><a href="#cb156-2"></a><span class="kw">summary</span>(Boston2)</span></code></pre></div>
<pre><code>##       medv            crim                rm            lstat      
##  Min.   : 5.00   Min.   : 0.00632   Min.   :3.561   Min.   : 1.73  
##  1st Qu.:17.02   1st Qu.: 0.08205   1st Qu.:5.886   1st Qu.: 6.95  
##  Median :21.20   Median : 0.25651   Median :6.208   Median :11.36  
##  Mean   :22.53   Mean   : 3.61352   Mean   :6.285   Mean   :12.65  
##  3rd Qu.:25.00   3rd Qu.: 3.67708   3rd Qu.:6.623   3rd Qu.:16.95  
##  Max.   :50.00   Max.   :88.97620   Max.   :8.780   Max.   :37.97</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1"></a><span class="kw">ggpairs</span>(Boston2)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<p>A distribuição das taxas de criminalidade é bastante assimétrica. Vamos considerar a log taxa em seu lugar.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1"></a>Boston2<span class="op">$</span>crim &lt;-<span class="st"> </span><span class="kw">log</span>(Boston2<span class="op">$</span>crim)</span>
<span id="cb159-2"><a href="#cb159-2"></a><span class="kw">ggpairs</span>(Boston2)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>As variáveis estão claramente correlacionadas, mas as relações, em vários casos, são acentuadamente não lineares, com variâncias não constantes.</p>
<p>Comecemos por um modelo linear em que as três covariáveis são incluídas aos preditores de mu e sigma através de termos paramétricos lineares.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1"></a>ajuste1 &lt;-<span class="st"> </span><span class="kw">gamlss</span>(medv <span class="op">~</span><span class="st"> </span>lstat <span class="op">+</span><span class="st"> </span>crim <span class="op">+</span><span class="st"> </span>rm,</span>
<span id="cb160-2"><a href="#cb160-2"></a>                  <span class="dt">sigma.fo=</span><span class="op">~</span><span class="st"> </span>lstat <span class="op">+</span><span class="st"> </span>crim <span class="op">+</span><span class="st"> </span>rm, <span class="dt">family =</span> NO, <span class="dt">data =</span> Boston2)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 3089.743 
## GAMLSS-RS iteration 2: Global Deviance = 3058.574 
## GAMLSS-RS iteration 3: Global Deviance = 3054.676 
## GAMLSS-RS iteration 4: Global Deviance = 3054.173 
## GAMLSS-RS iteration 5: Global Deviance = 3054.063 
## GAMLSS-RS iteration 6: Global Deviance = 3054.023 
## GAMLSS-RS iteration 7: Global Deviance = 3054.006 
## GAMLSS-RS iteration 8: Global Deviance = 3053.998 
## GAMLSS-RS iteration 9: Global Deviance = 3053.995 
## GAMLSS-RS iteration 10: Global Deviance = 3053.994 
## GAMLSS-RS iteration 11: Global Deviance = 3053.993</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1"></a><span class="kw">plot</span>(ajuste1)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<pre><code>## ******************************************************************
##        Summary of the Quantile Residuals
##                            mean   =  -0.007277051 
##                        variance   =  1.001928 
##                coef. of skewness  =  0.9792274 
##                coef. of kurtosis  =  5.225047 
## Filliben correlation coefficient  =  0.9708387 
## ******************************************************************</code></pre>
<p>Os termplots permitem avaliar os efeitos parciais das covariáveis nos parâmetros do modelo segundo o modelo ajustado.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1"></a><span class="kw">term.plot</span>(ajuste1, <span class="dt">what =</span> <span class="st">&#39;mu&#39;</span>, <span class="dt">pages =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1"></a><span class="kw">term.plot</span>(ajuste1, <span class="dt">what =</span> <span class="st">&#39;sigma&#39;</span>, <span class="dt">pages =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-41-2.png" width="672" /></p>
<p>Vamos ajustar novo modelo inserindo cada uma das variáveis (em ambos os preditores) através de smoothing splines.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1"></a>ajuste2 &lt;-<span class="st"> </span><span class="kw">gamlss</span>(medv <span class="op">~</span><span class="st"> </span><span class="kw">pb</span>(lstat) <span class="op">+</span><span class="st"> </span><span class="kw">pb</span>(crim) <span class="op">+</span><span class="st"> </span><span class="kw">pb</span>(rm),</span>
<span id="cb166-2"><a href="#cb166-2"></a>                  <span class="dt">sigma.fo=</span><span class="op">~</span><span class="st"> </span><span class="kw">pb</span>(lstat) <span class="op">+</span><span class="st"> </span><span class="kw">pb</span>(crim) <span class="op">+</span><span class="st"> </span><span class="kw">pb</span>(rm), <span class="dt">family =</span> NO, </span>
<span id="cb166-3"><a href="#cb166-3"></a>                  <span class="dt">data =</span> Boston2)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 2752.341 
## GAMLSS-RS iteration 2: Global Deviance = 2732.724 
## GAMLSS-RS iteration 3: Global Deviance = 2732.233 
## GAMLSS-RS iteration 4: Global Deviance = 2732.264 
## GAMLSS-RS iteration 5: Global Deviance = 2732.317 
## GAMLSS-RS iteration 6: Global Deviance = 2732.345 
## GAMLSS-RS iteration 7: Global Deviance = 2732.353 
## GAMLSS-RS iteration 8: Global Deviance = 2732.354</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1"></a><span class="kw">plot</span>(ajuste2)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<pre><code>## ******************************************************************
##        Summary of the Quantile Residuals
##                            mean   =  0.006594528 
##                        variance   =  1.001881 
##                coef. of skewness  =  0.9814753 
##                coef. of kurtosis  =  7.902191 
## Filliben correlation coefficient  =  0.9623505 
## ******************************************************************</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1"></a><span class="kw">term.plot</span>(ajuste2, <span class="dt">what =</span> <span class="st">&#39;mu&#39;</span>, <span class="dt">pages =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-42-2.png" width="672" /></p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1"></a><span class="kw">term.plot</span>(ajuste2, <span class="dt">what =</span> <span class="st">&#39;sigma&#39;</span>, <span class="dt">pages =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-42-3.png" width="672" /></p>
<p>Ao usar splines, o modelo acaba ajustando parte da não linearidade presente nos dados. No entanto, fica bem evidente, pelos gráficos de resíduos, que ainda não temos um bom ajuste. Vamos tentar outra distribuição. Para fins de ilustração, escolhemos a distribuição Box-Cox t (BCT).</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1"></a>ajuste3 &lt;-<span class="st"> </span><span class="kw">gamlss</span>(medv <span class="op">~</span><span class="st"> </span><span class="kw">pb</span>(lstat) <span class="op">+</span><span class="st"> </span><span class="kw">pb</span>(crim) <span class="op">+</span><span class="st"> </span><span class="kw">pb</span>(rm),</span>
<span id="cb172-2"><a href="#cb172-2"></a>                  <span class="dt">sigma.fo=</span><span class="op">~</span><span class="st"> </span><span class="kw">pb</span>(lstat) <span class="op">+</span><span class="st"> </span><span class="kw">pb</span>(crim) <span class="op">+</span><span class="st"> </span><span class="kw">pb</span>(rm), <span class="dt">family =</span> BCT, </span>
<span id="cb172-3"><a href="#cb172-3"></a>                  <span class="dt">data =</span> Boston2, <span class="dt">method =</span> <span class="kw">mixed</span>(<span class="dv">30</span>,<span class="dv">20</span>))</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 2571.664 
## GAMLSS-RS iteration 2: Global Deviance = 2563.132 
## GAMLSS-RS iteration 3: Global Deviance = 2559.434 
## GAMLSS-RS iteration 4: Global Deviance = 2557.24 
## GAMLSS-RS iteration 5: Global Deviance = 2555.886 
## GAMLSS-RS iteration 6: Global Deviance = 2555.084 
## GAMLSS-RS iteration 7: Global Deviance = 2554.583 
## GAMLSS-RS iteration 8: Global Deviance = 2554.256 
## GAMLSS-RS iteration 9: Global Deviance = 2554.043 
## GAMLSS-RS iteration 10: Global Deviance = 2553.908 
## GAMLSS-RS iteration 11: Global Deviance = 2553.822 
## GAMLSS-RS iteration 12: Global Deviance = 2553.769 
## GAMLSS-RS iteration 13: Global Deviance = 2553.735 
## GAMLSS-RS iteration 14: Global Deviance = 2553.713 
## GAMLSS-RS iteration 15: Global Deviance = 2553.699 
## GAMLSS-RS iteration 16: Global Deviance = 2553.691 
## GAMLSS-RS iteration 17: Global Deviance = 2553.685 
## GAMLSS-RS iteration 18: Global Deviance = 2553.682 
## GAMLSS-RS iteration 19: Global Deviance = 2553.679 
## GAMLSS-RS iteration 20: Global Deviance = 2553.678 
## GAMLSS-RS iteration 21: Global Deviance = 2553.677 
## GAMLSS-CG iteration 1: Global Deviance = 2553.676</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1"></a><span class="kw">plot</span>(ajuste3)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<pre><code>## ******************************************************************
##        Summary of the Quantile Residuals
##                            mean   =  -0.002389022 
##                        variance   =  1.002115 
##                coef. of skewness  =  0.0004482838 
##                coef. of kurtosis  =  3.11358 
## Filliben correlation coefficient  =  0.9977573 
## ******************************************************************</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1"></a><span class="kw">term.plot</span>(ajuste3, <span class="dt">what =</span> <span class="st">&#39;mu&#39;</span>, <span class="dt">pages =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-43-2.png" width="672" /></p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1"></a><span class="kw">term.plot</span>(ajuste3, <span class="dt">what =</span> <span class="st">&#39;sigma&#39;</span>, <span class="dt">pages =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-43-3.png" width="672" /></p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1"></a><span class="kw">GAIC</span>(ajuste1, ajuste2, ajuste3, <span class="dt">k =</span> <span class="fl">3.84</span>)</span></code></pre></div>
<pre><code>##               df      AIC
## ajuste3 37.67671 2698.355
## ajuste2 22.58352 2819.075
## ajuste1  8.00000 3084.713</code></pre>
<p>O ajuste com distribuição BCT é claramente superior aos produzidos usando distribuição Normal. Os resíduos apresentam comportamento adequado (distribuição normal, variância homogênea, poucos resíduos com valores mais extremos).</p>
<p>Podemos testar a inclusão de covariáveis também nos dois outros parâmetros do modelo.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1"></a>ajuste4 &lt;-<span class="st"> </span><span class="kw">update</span>(ajuste3, <span class="dt">nu.formula=</span><span class="op">~</span><span class="st"> </span>lstat <span class="op">+</span><span class="st"> </span>crim <span class="op">+</span><span class="st"> </span>rm, <span class="dt">tau.formula=</span><span class="op">~</span><span class="st"> </span>lstat <span class="op">+</span><span class="st"> </span>crim <span class="op">+</span><span class="st"> </span>rm)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 2547.843 
## GAMLSS-RS iteration 2: Global Deviance = 2531.275 
## GAMLSS-RS iteration 3: Global Deviance = 2526.818 
## GAMLSS-RS iteration 4: Global Deviance = 2524.122 
## GAMLSS-RS iteration 5: Global Deviance = 2522.978 
## GAMLSS-RS iteration 6: Global Deviance = 2522.434 
## GAMLSS-RS iteration 7: Global Deviance = 2522.128 
## GAMLSS-RS iteration 8: Global Deviance = 2521.994 
## GAMLSS-RS iteration 9: Global Deviance = 2521.93 
## GAMLSS-RS iteration 10: Global Deviance = 2521.896 
## GAMLSS-RS iteration 11: Global Deviance = 2521.889 
## GAMLSS-RS iteration 12: Global Deviance = 2521.881 
## GAMLSS-RS iteration 13: Global Deviance = 2521.881 
## GAMLSS-CG iteration 1: Global Deviance = 2521.891 
## GAMLSS-CG iteration 2: Global Deviance = 2521.881 
## GAMLSS-CG iteration 3: Global Deviance = 2521.881</code></pre>
<p>Agora vamos testar via TRV (teste da razão de verossimilhanças) a inclusão dos parâmetros.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1"></a><span class="kw">LR.test</span>(ajuste3, ajuste4)</span></code></pre></div>
<pre><code>##  Likelihood Ratio Test for nested GAMLSS models. 
##  (No check whether the models are nested is performed). 
##  
##        Null model: deviance= 2553.676 with  37.67671 deg. of freedom 
##  Altenative model: deviance= 2521.881 with  43.97486 deg. of freedom 
##  
##  LRT = 31.79482 with 6.298145 deg. of freedom and p-value= 2.364604e-05</code></pre>
<p>Os termos incluídos são estatisticamente significativos (p&lt;0.001)</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1"></a><span class="kw">summary</span>(ajuste4)</span></code></pre></div>
<pre><code>## ******************************************************************
## Family:  c(&quot;BCT&quot;, &quot;Box-Cox t&quot;) 
## 
## Call:  gamlss(formula = medv ~ pb(lstat) + pb(crim) + pb(rm),  
##     sigma.formula = ~pb(lstat) + pb(crim) + pb(rm),  
##     nu.formula = ~lstat + crim + rm, tau.formula = ~lstat +  
##         crim + rm, family = BCT, data = Boston2, method = mixed(30,  
##         20)) 
## 
## Fitting method: mixed(30, 20) 
## 
## ------------------------------------------------------------------
## Mu link function:  identity
## Mu Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  6.96182    1.58336   4.397 1.36e-05 ***
## pb(lstat)   -0.41975    0.02364 -17.759  &lt; 2e-16 ***
## pb(crim)    -0.74627    0.06664 -11.199  &lt; 2e-16 ***
## pb(rm)       2.99361    0.23158  12.927  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------------------------------
## Sigma link function:  log
## Sigma Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -2.354752   0.518335  -4.543 7.09e-06 ***
## pb(lstat)   -0.003485   0.009206  -0.379    0.705    
## pb(crim)     0.199373   0.025646   7.774 4.98e-14 ***
## pb(rm)       0.066594   0.070239   0.948    0.344    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------------------------------
## Nu link function:  identity 
## Nu Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -10.26954    2.71885  -3.777 0.000179 ***
## lstat         0.10893    0.03868   2.816 0.005066 ** 
## crim         -0.32930    0.15410  -2.137 0.033132 *  
## rm            1.37369    0.38500   3.568 0.000397 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------------------------------
## Tau link function:  log 
## Tau Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -0.12104    4.71602  -0.026 0.979535    
## lstat       -0.14246    0.05657  -2.518 0.012128 *  
## crim         1.10108    0.31588   3.486 0.000538 ***
## rm           0.97794    0.71109   1.375 0.169716    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------------------------------
## NOTE: Additive smoothing terms exist in the formulas: 
##  i) Std. Error for smoothers are for the linear effect only. 
## ii) Std. Error for the linear terms maybe are not accurate. 
## ------------------------------------------------------------------
## No. of observations in the fit:  506 
## Degrees of Freedom for the fit:  43.97486
##       Residual Deg. of Freedom:  462.0251 
##                       at cycle:  3 
##  
## Global Deviance:     2521.881 
##             AIC:     2609.831 
##             SBC:     2795.692 
## ******************************************************************</code></pre>
<p>Na sequência poderíamos avaliar a remoção de covariáveis em alguns dos preditores, a inclusão de suavizadores em nu e tau, a remoção de suavizadores em mu e sigma.</p>
<p>Vamos extrair os valores ajustados de mu, sigma, nu e tau para cada subúrbio.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1"></a><span class="kw">fitted</span>(ajuste4, <span class="dt">what =</span> <span class="st">&#39;mu&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 24.39550 21.95257 35.47485 34.01641 33.95100 25.00361 20.49963 17.69590
##  [9] 14.47948 18.46754</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1"></a><span class="kw">fitted</span>(ajuste4, <span class="dt">what =</span> <span class="st">&#39;sigma&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 0.03528248 0.06063900 0.07835784 0.08544871 0.10741007 0.06393369
##  [7] 0.08566811 0.08789584 0.10554844 0.09349833</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1"></a><span class="kw">fitted</span>(ajuste4, <span class="dt">what =</span> <span class="st">&#39;nu&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##         1         2         3         4         5         6         7         8 
## 0.9722153 0.7319636 1.2250071 0.7931965 1.0087728 0.2869412 0.1422034 0.9316866 
##         9        10 
## 1.2379395 0.4241338</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1"></a><span class="kw">fitted</span>(ajuste4, <span class="dt">what =</span> <span class="st">&#39;tau&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##          1          2          3          4          5          6          7 
##  1.0242167  2.4399203 10.6566005 12.5099408 23.7082580  4.7516839  3.7252458 
##          8          9         10 
##  2.8779596  0.5543787  3.9103060</code></pre>
<p>Como alternativa podemos usar o predict para isso.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1"></a><span class="kw">predict</span>(ajuste4, <span class="dt">what =</span> <span class="st">&#39;mu&#39;</span>, <span class="dt">type =</span> <span class="st">&#39;response&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 24.39550 21.95257 35.47485 34.01641 33.95100 25.00361 20.49963 17.69590
##  [9] 14.47948 18.46754</code></pre>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1"></a><span class="kw">predict</span>(ajuste4, <span class="dt">what =</span> <span class="st">&#39;sigma&#39;</span>, <span class="dt">type =</span> <span class="st">&#39;response&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 0.03528248 0.06063900 0.07835784 0.08544871 0.10741007 0.06393369
##  [7] 0.08566811 0.08789584 0.10554844 0.09349833</code></pre>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1"></a><span class="kw">predict</span>(ajuste4, <span class="dt">what =</span> <span class="st">&#39;nu&#39;</span>, <span class="dt">type =</span> <span class="st">&#39;response&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##         1         2         3         4         5         6         7         8 
## 0.9722153 0.7319636 1.2250071 0.7931965 1.0087728 0.2869412 0.1422034 0.9316866 
##         9        10 
## 1.2379395 0.4241338</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1"></a><span class="kw">predict</span>(ajuste4, <span class="dt">what =</span> <span class="st">&#39;tau&#39;</span>, <span class="dt">type =</span> <span class="st">&#39;response&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##          1          2          3          4          5          6          7 
##  1.0242167  2.4399203 10.6566005 12.5099408 23.7082580  4.7516839  3.7252458 
##          8          9         10 
##  2.8779596  0.5543787  3.9103060</code></pre>
<p>A vantagem do predict é a possibilidade de fazer predições para novas observações. Vamos fazer predições para um subúrbio hipotético com log(crim)=0, rm=5, lstat=5.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1"></a>nov_sub &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">crim =</span> <span class="dv">0</span>, <span class="dt">rm =</span> <span class="dv">5</span>, <span class="dt">lstat =</span> <span class="dv">5</span>)</span>
<span id="cb202-2"><a href="#cb202-2"></a></span>
<span id="cb202-3"><a href="#cb202-3"></a>mu_chap &lt;-<span class="st"> </span><span class="kw">predict</span>(ajuste4, <span class="dt">newdata =</span> nov_sub, <span class="dt">what =</span> <span class="st">&#39;mu&#39;</span>, <span class="dt">type =</span> <span class="st">&#39;response&#39;</span>); mu_chap</span></code></pre></div>
<pre><code>## new prediction 
## New way of prediction in pb()  (starting from GAMLSS version 5.0-3) 
## New way of prediction in pb()  (starting from GAMLSS version 5.0-3) 
## New way of prediction in pb()  (starting from GAMLSS version 5.0-3)</code></pre>
<pre><code>## [1] 23.78453</code></pre>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1"></a>sig_chap &lt;-<span class="st"> </span><span class="kw">predict</span>(ajuste4, <span class="dt">newdata =</span> nov_sub, <span class="dt">what =</span> <span class="st">&#39;sigma&#39;</span>, <span class="dt">type =</span> <span class="st">&#39;response&#39;</span>); sig_chap</span></code></pre></div>
<pre><code>## new prediction 
## New way of prediction in pb()  (starting from GAMLSS version 5.0-3) 
## New way of prediction in pb()  (starting from GAMLSS version 5.0-3) 
## New way of prediction in pb()  (starting from GAMLSS version 5.0-3)</code></pre>
<pre><code>## [1] 0.1445014</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1"></a>nu_chap &lt;-<span class="st"> </span><span class="kw">predict</span>(ajuste4, <span class="dt">newdata =</span> nov_sub, <span class="dt">what =</span> <span class="st">&#39;nu&#39;</span>, <span class="dt">type =</span> <span class="st">&#39;response&#39;</span>); nu_chap</span></code></pre></div>
<pre><code>## [1] -2.856418</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1"></a>tau_chap &lt;-<span class="st"> </span><span class="kw">predict</span>(ajuste4, <span class="dt">newdata =</span> nov_sub, <span class="dt">what =</span> <span class="st">&#39;tau&#39;</span>, <span class="dt">type =</span> <span class="st">&#39;response&#39;</span>); tau_chap</span></code></pre></div>
<pre><code>## [1] 57.76274</code></pre>
<p>Usando as estimativas obtidas para os quatro parâmetros, vamos plotar o modelo (função densidade de probabilidade) ajustado.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1"></a><span class="kw">curve</span>(<span class="kw">dBCT</span>(x, <span class="dt">mu =</span> mu_chap, <span class="dt">sigma =</span> sig_chap, <span class="dt">nu =</span> nu_chap, <span class="dt">tau =</span> tau_chap), <span class="dt">from =</span> <span class="dv">10</span>, <span class="dt">to =</span> <span class="dv">50</span>,</span>
<span id="cb212-2"><a href="#cb212-2"></a>      <span class="dt">xlab =</span> <span class="st">&#39;medv&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Densidade&#39;</span>)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<p>Algumas estimativas para esse subúrbio:</p>
<div id="pmedv25" class="section level4">
<h4>P(medv&lt;25)</h4>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1"></a><span class="kw">pBCT</span>(<span class="dv">25</span>, <span class="dt">mu =</span> mu_chap, <span class="dt">sigma =</span> sig_chap, <span class="dt">nu =</span> nu_chap, <span class="dt">tau =</span> tau_chap)</span></code></pre></div>
<pre><code>## [1] 0.6313578</code></pre>
</div>
<div id="pmedv30" class="section level4">
<h4>P(medv&gt;30)</h4>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1"></a><span class="kw">pBCT</span>(<span class="dv">30</span>, <span class="dt">mu =</span> mu_chap, <span class="dt">sigma =</span> sig_chap, <span class="dt">nu =</span> nu_chap, <span class="dt">tau =</span> tau_chap, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] 0.1142909</code></pre>
</div>
<div id="p20medv30" class="section level4">
<h4>P(20&lt;medv&lt;30)</h4>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1"></a><span class="kw">pBCT</span>(<span class="dv">30</span>, <span class="dt">mu =</span> mu_chap, <span class="dt">sigma =</span> sig_chap, <span class="dt">nu =</span> nu_chap, <span class="dt">tau =</span> tau_chap)<span class="op">-</span></span>
<span id="cb217-2"><a href="#cb217-2"></a><span class="st">    </span><span class="kw">pBCT</span>(<span class="dv">20</span>, <span class="dt">mu =</span> mu_chap, <span class="dt">sigma =</span> sig_chap, <span class="dt">nu =</span> nu_chap, <span class="dt">tau =</span> tau_chap)</span></code></pre></div>
<pre><code>## [1] 0.8220397</code></pre>
<p>Mediana para medv estimada para subúrbios som essas características</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1"></a><span class="kw">qBCT</span>(<span class="fl">0.5</span>, <span class="dt">mu =</span> mu_chap, <span class="dt">sigma =</span> sig_chap, <span class="dt">nu =</span> nu_chap, <span class="dt">tau =</span> tau_chap)</span></code></pre></div>
<pre><code>## [1] 23.74451</code></pre>
<p>Quintis estimados para medv estimada para subúrbios som essas características</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1"></a><span class="kw">qBCT</span>(<span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>,<span class="fl">0.8</span>), <span class="dt">mu =</span> mu_chap, <span class="dt">sigma =</span> sig_chap, <span class="dt">nu =</span> nu_chap, <span class="dt">tau =</span> tau_chap)</span></code></pre></div>
<pre><code>## [1] 21.39718 22.93815 24.66944 27.49413</code></pre>
<p>Repetir as análises para um subúrbio hipotético com log(crim)=1, rm=8, lstat=15</p>
<p>A título de ilustração, vamos aplicar diferentes termos aditivos num mesmo modelo.</p>
<p>Preditor de mu:<br />
- lstat: termo paramétrico linear;<br />
- crim: natural spline com dois graus de liberdade;<br />
- rm: smoothing splines, com graus de liberdade a serem estimados.</p>
<p>Preditor de sigma:<br />
- lstat: removido do modelo, efeito parcial aproximadamente constante;<br />
- crim: polinômio cúbico;<br />
- rm: regression splines linear, com um único nó em 5.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1"></a>ajuste5 &lt;-<span class="st"> </span><span class="kw">gamlss</span>(medv <span class="op">~</span><span class="st"> </span>lstat <span class="op">+</span><span class="st"> </span><span class="kw">ns</span>(crim, <span class="dt">df =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">pb</span>(rm), </span>
<span id="cb223-2"><a href="#cb223-2"></a>                  <span class="dt">sigma.fo=</span><span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(crim,<span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">bs</span>(rm, <span class="dt">knots =</span> <span class="dv">5</span>, <span class="dt">degree =</span> <span class="dv">1</span>), </span>
<span id="cb223-3"><a href="#cb223-3"></a>                  <span class="dt">family =</span> BCT, <span class="dt">data =</span> Boston, <span class="dt">method =</span> <span class="kw">RS</span>(<span class="dv">30</span>))</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 2661.831 
## GAMLSS-RS iteration 2: Global Deviance = 2654.718 
## GAMLSS-RS iteration 3: Global Deviance = 2653.909 
## GAMLSS-RS iteration 4: Global Deviance = 2653.701 
## GAMLSS-RS iteration 5: Global Deviance = 2653.637 
## GAMLSS-RS iteration 6: Global Deviance = 2653.617 
## GAMLSS-RS iteration 7: Global Deviance = 2653.609 
## GAMLSS-RS iteration 8: Global Deviance = 2653.605 
## GAMLSS-RS iteration 9: Global Deviance = 2653.604 
## GAMLSS-RS iteration 10: Global Deviance = 2653.603</code></pre>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1"></a><span class="kw">term.plot</span>(ajuste5, <span class="dt">what =</span> <span class="st">&#39;mu&#39;</span>, <span class="dt">pages =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1"></a><span class="kw">term.plot</span>(ajuste5, <span class="dt">what =</span> <span class="st">&#39;sigma&#39;</span>, <span class="dt">pages =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-56-2.png" width="672" /></p>
</div>
</div>
<div id="conteúdo-adicional" class="section level3">
<h3><span style="color:#05C086">Conteúdo adicional</span></h3>
<div id="suavizadores-para-os-níveis-de-fatores---a-função-pcat" class="section level4">
<h4>Suavizadores para os níveis de fatores - a função pcat()</h4>
<p>Neste exemplo, vamos ilustrar a aplicação do suavizador implementado em pcat(), com o objetivo de agrupar níveis de um fator com efeitos semelhantes.</p>
<p>Vamos usar a base de dados disponível na página da disciplina. Trata-se de um estudo sobre a eficácia de diferentes abordagens de venda de um produto. As variáveis são as seguintes:</p>
<ul>
<li>abordagem: um fator com oito níveis (A-H), identificando o tipo de abordagem para venda;<br />
</li>
<li>renda: em milhares de reais;<br />
</li>
<li>venda: se a venda foi efetuada (Sim ou Não).</li>
</ul>
<p>O objetivo é modelar a probabilidade de venda em função da abordagem e ajustado também pela renda do indivíduo. Para isso, vamos usar regressão logística (família binomial).</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1"></a>dados &lt;-<span class="st"> </span><span class="kw">read.csv2</span>(<span class="st">&#39;https://docs.ufpr.br/~taconeli/CE06218/Dados4.csv&#39;</span>)[,<span class="op">-</span><span class="dv">1</span>]</span></code></pre></div>
</div>
<div id="análise-descritiva" class="section level4">
<h4>Análise descritiva</h4>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1"></a>tab1 &lt;-<span class="st"> </span><span class="kw">table</span>(dados<span class="op">$</span>abordagem, dados<span class="op">$</span>venda)</span>
<span id="cb228-2"><a href="#cb228-2"></a>tab2 &lt;-<span class="st"> </span><span class="kw">prop.table</span>(tab1, <span class="dv">1</span>)</span>
<span id="cb228-3"><a href="#cb228-3"></a>dtab2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(tab2)</span>
<span id="cb228-4"><a href="#cb228-4"></a><span class="kw">names</span>(dtab2) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Abordagem&#39;</span>, <span class="st">&#39;Venda&#39;</span>, <span class="st">&#39;Frequência&#39;</span>)</span>
<span id="cb228-5"><a href="#cb228-5"></a></span>
<span id="cb228-6"><a href="#cb228-6"></a><span class="kw">ggplot</span>(<span class="dt">data=</span>dtab2, <span class="kw">aes</span>(<span class="dt">x=</span>Abordagem, <span class="dt">y=</span>Frequência, <span class="dt">fill=</span>Venda)) <span class="op">+</span></span>
<span id="cb228-7"><a href="#cb228-7"></a><span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">position=</span><span class="kw">position_dodge</span>()) <span class="op">+</span></span>
<span id="cb228-8"><a href="#cb228-8"></a><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">14</span>)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> dados, <span class="kw">aes</span>(<span class="dt">x=</span>venda, <span class="dt">y=</span>renda, <span class="dt">fill=</span>venda)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()<span class="op">+</span></span>
<span id="cb229-2"><a href="#cb229-2"></a><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">14</span>)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-58-2.png" width="672" /></p>
</div>
<div id="modelos-ajustados" class="section level4">
<h4>Modelos ajustados</h4>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1"></a>dados<span class="op">$</span>venda[dados<span class="op">$</span>venda <span class="op">==</span><span class="st"> &quot;Sim&quot;</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb230-2"><a href="#cb230-2"></a>dados<span class="op">$</span>venda[dados<span class="op">$</span>venda <span class="op">==</span><span class="st"> &quot;Não&quot;</span>] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb230-3"><a href="#cb230-3"></a>dados<span class="op">$</span>venda &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(dados<span class="op">$</span>venda)</span></code></pre></div>
</div>
<div id="modelo-nulo" class="section level4">
<h4>Modelo nulo</h4>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1"></a>ajuste_null &lt;-<span class="st"> </span><span class="kw">gamlss</span>(venda <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">family =</span> BI, <span class="dt">data =</span> dados)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1258.22 
## GAMLSS-RS iteration 2: Global Deviance = 1258.22</code></pre>
</div>
<div id="modelo-com-efeito-de-renda-sem-suavizador" class="section level4">
<h4>Modelo com efeito de renda (sem suavizador)</h4>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1"></a>ajuste1 &lt;-<span class="st"> </span><span class="kw">gamlss</span>(venda <span class="op">~</span><span class="st"> </span>renda, <span class="dt">family =</span> BI, <span class="dt">data =</span> dados)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1128.295 
## GAMLSS-RS iteration 2: Global Deviance = 1128.295</code></pre>
</div>
<div id="modelo-com-efeito-de-renda-e-abordagem-sem-suavizador" class="section level4">
<h4>Modelo com efeito de renda e abordagem (sem suavizador)</h4>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1"></a>ajuste2 &lt;-<span class="st"> </span><span class="kw">gamlss</span>(venda <span class="op">~</span><span class="st"> </span>renda <span class="op">+</span><span class="st"> </span>abordagem, <span class="dt">family =</span> BI, <span class="dt">data =</span> dados)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1090.188 
## GAMLSS-RS iteration 2: Global Deviance = 1090.188</code></pre>
</div>
<div id="modelo-com-efeito-de-renda-e-abordagem-com-suavizador-para-renda" class="section level4">
<h4>Modelo com efeito de renda e abordagem (com suavizador para renda)</h4>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1"></a>ajuste3 &lt;-<span class="st"> </span><span class="kw">gamlss</span>(venda <span class="op">~</span><span class="st"> </span><span class="kw">pb</span>(renda) <span class="op">+</span><span class="st"> </span>abordagem, <span class="dt">family =</span> BI, <span class="dt">data =</span> dados)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1079.322 
## GAMLSS-RS iteration 2: Global Deviance = 1079.322</code></pre>
</div>
<div id="modelo-com-efeito-de-renda-e-abordagem-com-suavizador-para-abordagem" class="section level4">
<h4>Modelo com efeito de renda e abordagem (com suavizador para abordagem)</h4>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1"></a>ajuste4 &lt;-<span class="st"> </span><span class="kw">gamlss</span>(venda <span class="op">~</span><span class="st"> </span>renda <span class="op">+</span><span class="st"> </span><span class="kw">pcat</span>(abordagem), <span class="dt">family =</span> BI, <span class="dt">data =</span> dados)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1091.079 
## GAMLSS-RS iteration 2: Global Deviance = 1091.08</code></pre>
</div>
<div id="modelo-com-efeito-de-renda-e-abordagem-com-suavizador-para-ambas" class="section level4">
<h4>Modelo com efeito de renda e abordagem (com suavizador para ambas)</h4>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1"></a>ajuste5 &lt;-<span class="st"> </span><span class="kw">gamlss</span>(venda <span class="op">~</span><span class="st"> </span><span class="kw">pb</span>(renda) <span class="op">+</span><span class="st"> </span><span class="kw">pcat</span>(abordagem), <span class="dt">family =</span> BI, <span class="dt">data =</span> dados)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1080.215 
## GAMLSS-RS iteration 2: Global Deviance = 1080.215</code></pre>
</div>
</div>
<div id="comparação-de-gaic" class="section level3">
<h3>Comparação de GAIC</h3>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1"></a><span class="kw">GAIC</span>(ajuste_null, ajuste1, ajuste2, ajuste3, ajuste4, ajuste5, <span class="dt">k =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##                    df      AIC
## ajuste5      6.079572 1098.454
## ajuste4      4.401060 1104.283
## ajuste3     10.648251 1111.267
## ajuste2      9.000000 1117.188
## ajuste1      2.000000 1134.296
## ajuste_null  1.000000 1261.220</code></pre>
<p>O ajuste5, com suavizador para renda e abordagem, produziu menor valor de GAIC. É o modelo selecionado.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1"></a><span class="kw">plot</span>(ajuste5)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<pre><code>## ******************************************************************
##   Summary of the Randomised Quantile Residuals
##                            mean   =  -0.01730587 
##                        variance   =  1.042726 
##                coef. of skewness  =  -0.02202779 
##                coef. of kurtosis  =  2.733024 
## Filliben correlation coefficient  =  0.9990548 
## ******************************************************************</code></pre>
<div id="diagnóstico-de-resíduos" class="section level4">
<h4>Diagnóstico de resíduos</h4>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1"></a><span class="kw">coef</span>(<span class="kw">getSmo</span>(ajuste5, <span class="dt">which =</span> <span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] -0.4990936 -0.4990936  0.1350928  0.5760793 -0.4990936  0.5760793  0.1350928
## [8] -0.1021002</code></pre>
</div>
<div id="estimativas-dos-parâmetros-para-o-fator" class="section level4">
<h4>Estimativas dos parâmetros para o fator</h4>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1"></a>abord2 &lt;-<span class="st"> </span><span class="kw">getSmo</span>(ajuste5, <span class="dt">which =</span> <span class="dv">2</span>)<span class="op">$</span>factor</span>
<span id="cb249-2"><a href="#cb249-2"></a>abord2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 0.135  0.576  -0.499 -0.499 0.135  -0.499 -0.499 0.576  0.576  -0.102
## Levels: -0.499 -0.102 0.135 0.576</code></pre>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1"></a><span class="kw">nlevels</span>(abord2)</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>A suavização resultou em uma reconfiguração para os níveis de abordagem. Agora, temos apenas quatro níveis. Agora, vamos visualizar o processo de suavização para essa variável categórica.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1"></a>df &lt;-<span class="st"> </span><span class="kw">getSmo</span>(ajuste5, <span class="dt">which =</span> <span class="dv">2</span>)<span class="op">$</span>edf</span>
<span id="cb253-2"><a href="#cb253-2"></a>df</span></code></pre></div>
<pre><code>## [1] 3.442431</code></pre>
<p>Graus de liberdade para o suavizador.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1"></a>lambda &lt;-<span class="st"> </span><span class="kw">getSmo</span>(ajuste5, <span class="dt">which =</span> <span class="dv">2</span>)<span class="op">$</span>lambda</span>
<span id="cb255-2"><a href="#cb255-2"></a>lambda</span></code></pre></div>
<pre><code>## [1] 0.1478951</code></pre>
</div>
<div id="parâmetro-de-penalização" class="section level4">
<h4>parâmetro de penalização</h4>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1"></a><span class="co"># plotLambda(formula=venda ~ pb(renda), factor = abordagem, data = dados, along = seq(-10, 2, 0.5), family = BI)</span></span></code></pre></div>
</div>
<div id="suavização-em-função-de-log-lambda." class="section level4">
<h4>Suavização em função de (log) lambda.</h4>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1"></a><span class="co"># abline(v = log(lambda), col = &#39;red&#39;)</span></span></code></pre></div>
<p>Representação do valor de lambda aplicado. Assim, podemos ver que os níveis originais de abordagem foram agrupados da seguinte forma: Nível 1: A, B, E; Nível 2: H; Nível 3: G, C; Nível 4: D, F.</p>
<p>Vamos experimentar um método alternativo de estimação para lambda (GAIC):</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1"></a>ajuste5_v2 &lt;-<span class="st"> </span><span class="kw">gamlss</span>(venda <span class="op">~</span><span class="st"> </span><span class="kw">pb</span>(renda) <span class="op">+</span><span class="st"> </span><span class="kw">pcat</span>(abordagem, <span class="dt">method =</span> <span class="st">&quot;GAIC&quot;</span>, <span class="dt">k =</span> <span class="dv">3</span>), </span>
<span id="cb259-2"><a href="#cb259-2"></a>                     <span class="dt">family =</span> BI, <span class="dt">data =</span> dados)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1082.025 
## GAMLSS-RS iteration 2: Global Deviance = 1082.02 
## GAMLSS-RS iteration 3: Global Deviance = 1082.02</code></pre>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1"></a><span class="kw">AIC</span>(ajuste5, ajuste5_v2, <span class="dt">k =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##                  df      AIC
## ajuste5_v2 5.290037 1097.890
## ajuste5    6.079572 1098.454</code></pre>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1"></a>lambda2 &lt;-<span class="st"> </span><span class="kw">getSmo</span>(ajuste5_v2, <span class="dt">which =</span> <span class="dv">2</span>)<span class="op">$</span>lambda</span>
<span id="cb263-2"><a href="#cb263-2"></a>lambda2</span></code></pre></div>
<pre><code>## [1] 0.2074314</code></pre>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1"></a><span class="co"># abline(v = log(lambda2), col = &#39;blue&#39;)</span></span></code></pre></div>
<p>A penalização é ligeiramente maior. Mas os níveis do fator original são agrupados de maneira similar à anterior.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1"></a>abord3 &lt;-<span class="st"> </span><span class="kw">getSmo</span>(ajuste5, <span class="dt">which =</span> <span class="dv">2</span>)<span class="op">$</span>factor</span>
<span id="cb266-2"><a href="#cb266-2"></a>abord3 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 0.135  0.576  -0.499 -0.499 0.135  -0.499 -0.499 0.576  0.576  -0.102
## Levels: -0.499 -0.102 0.135 0.576</code></pre>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1"></a><span class="kw">nlevels</span>(abord3)</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1"></a><span class="kw">term.plot</span>(ajuste5, <span class="dt">what =</span> <span class="st">&#39;mu&#39;</span>, <span class="dt">terms =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="mod4_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<p>Gráfico para o efeito de renda no logito da probabilidade de venda.</p>
<p>E se ajustarmos um novo modelo, análogo ao ajuste3 (com suavizador para renda, mas não para abordagem), mas substituindo o fator abordagem pelo novo fator, com quatro níveis?</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1"></a>ajuste3_v2 &lt;-<span class="st"> </span><span class="kw">gamlss</span>(venda <span class="op">~</span><span class="st"> </span><span class="kw">pb</span>(renda) <span class="op">+</span><span class="st"> </span>abord2, <span class="dt">family =</span> BI, <span class="dt">data =</span> dados)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1079.749 
## GAMLSS-RS iteration 2: Global Deviance = 1079.749</code></pre>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1"></a><span class="kw">GAIC</span>(ajuste5, ajuste3_v2)</span></code></pre></div>
<pre><code>##                  df      AIC
## ajuste5    6.079572 1092.374
## ajuste3_v2 6.647356 1093.043</code></pre>
<p>Os ajustes não são idênticos, uma vez que, no caso do ajuste com suavizador para abordagem, temos o efeito adicional da penalização.</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4,h5",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
